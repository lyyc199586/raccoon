<!DOCTYPE html><head><meta charset="UTF-8"><title>Just in Time Compilation | RACCOON</title><link rel="icon" type="image/x-icon" href="../../../media/raccoon_icon.png" sizes="16x16 32x32 64x64 128x128"></link><link href="../../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../../contrib/jquery/jquery.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../../index.html" class="left moose-logo hide-on-med-and-down">RACCOON</a><a href="https://github.com/hugary1995/raccoon" class="right"><img src="../../../media/framework/github-logo.png" class="github-mark"></img><img src="../../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="#!" class="dropdown-trigger" data-target="e47a822d-4316-4d67-90ad-1cadfa73a0dc" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="3e9d08ae-5f68-4d79-87ed-178bb945992a" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="cc476ac0-7944-4922-96d4-5079d5ba678b" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="409e5fb7-a312-4e6a-a4f6-4103a2b4de00" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../../contribute/index.html">Contribute</a></li></ul><a href="#" class="sidenav-trigger" data-target="9768ca18-9c8e-4939-9bc1-82ec73e7c854"><i class="material-icons">menu</i></a><ul class="sidenav" id="9768ca18-9c8e-4939-9bc1-82ec73e7c854"><li><a href="#!" class="dropdown-trigger" data-target="0e441806-3ac2-4050-8d89-1da6bda34635" data-constrainWidth="false">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="522bb54f-d996-4660-b829-e848e56612aa" data-constrainWidth="false">Tutorials<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="37b5cd3f-777d-4c90-a818-23a908c6070c" data-constrainWidth="false">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="#!" class="dropdown-trigger" data-target="c8035d71-9623-4167-ba42-1601b29fa6f0" data-constrainWidth="false">Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li><a href="../../../contribute/index.html">Contribute</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div><ul class="dropdown-content" id="e47a822d-4316-4d67-90ad-1cadfa73a0dc"><li><a href="../../../getting_started/install.html">Install RACCOON</a></li><li><a href="../../../getting_started/update.html">Update RACCOON</a></li><li><a href="../../../getting_started/running.html">Running your first model</a></li><li><a href="../../../getting_started/paraview.html">Visualization</a></li><li><a href="../../../getting_started/ide.html">Code development</a></li></ul><ul class="dropdown-content" id="3e9d08ae-5f68-4d79-87ed-178bb945992a"><li><a href="../../../tutorials/01_small_deformation_elasticity.html">1. Small deformation</a></li><li><a href="../../../tutorials/02_mode1_brittle_fracture.html">2. Mode-I fracture</a></li><li><a href="../../../tutorials/03_mode2_brittle_fracture.html">3. Mode-II fracture</a></li><li><a href="../../../tutorials/04_fiber_reinforced_matrix.html">4. Fiber-reinforced matrix</a></li><li><a href="../../../tutorials/05_soil_desiccation.html">5. Soil desiccation</a></li><li><a href="../../../tutorials/06_large_deformation_elasticity.html">6. Large deformation</a></li><li><a href="../../../tutorials/07_elastoplasticity.html">7. Elastoplasticity</a></li><li><a href="../../../tutorials/08_ductile_fracture.html">8. Ductile fracture</a></li><li><a href="../../../tutorials/09_three_point_bending.html">9. Three-point bending</a></li><li><a href="../../../tutorials/10_quenching_bibeam.html">10. Quenching of bi-beam</a></li><li><a href="../../../tutorials/11_adaptivity.html">11. Adaptive mesh refinement</a></li><li><a href="../../../tutorials/12_surfing_boundary_problem.html">12. Surfing Boundary Problem</a></li></ul><ul class="dropdown-content" id="cc476ac0-7944-4922-96d4-5079d5ba678b"><li><a href="../../../theory/intro.html">Introduction</a></li><li><a href="../../../theory/kinematics.html">State variables and kinematics</a></li><li><a href="../../../theory/thermodynamics.html">Thermodynamics</a></li><li><a href="../../../theory/minimization.html">The minimization problem</a></li><li><a href="../../../theory/constitutive_models.html">Constitutive Models</a></li></ul><ul class="dropdown-content" id="409e5fb7-a312-4e6a-a4f6-4103a2b4de00"><li><a href="../../index.html">Physics modules</a></li><li><a href="../../../syntax/index.html">Complete syntax</a></li><li><a href="../../../syntax/raccoon.html">RACCOON syntax</a></li><li><a href="../../../syntax/tensor_mechanics.html">Tensor mechanics syntax</a></li><li><a href="../../../syntax/phase_field.html">Phase field syntax</a></li><li><a href="../../../syntax/heat_conduction.html">Heat conduction syntax</a></li></ul><ul class="dropdown-content" id="0e441806-3ac2-4050-8d89-1da6bda34635"><li><a href="../../../getting_started/install.html">Install RACCOON</a></li><li><a href="../../../getting_started/update.html">Update RACCOON</a></li><li><a href="../../../getting_started/running.html">Running your first model</a></li><li><a href="../../../getting_started/paraview.html">Visualization</a></li><li><a href="../../../getting_started/ide.html">Code development</a></li></ul><ul class="dropdown-content" id="522bb54f-d996-4660-b829-e848e56612aa"><li><a href="../../../tutorials/01_small_deformation_elasticity.html">1. Small deformation</a></li><li><a href="../../../tutorials/02_mode1_brittle_fracture.html">2. Mode-I fracture</a></li><li><a href="../../../tutorials/03_mode2_brittle_fracture.html">3. Mode-II fracture</a></li><li><a href="../../../tutorials/04_fiber_reinforced_matrix.html">4. Fiber-reinforced matrix</a></li><li><a href="../../../tutorials/05_soil_desiccation.html">5. Soil desiccation</a></li><li><a href="../../../tutorials/06_large_deformation_elasticity.html">6. Large deformation</a></li><li><a href="../../../tutorials/07_elastoplasticity.html">7. Elastoplasticity</a></li><li><a href="../../../tutorials/08_ductile_fracture.html">8. Ductile fracture</a></li><li><a href="../../../tutorials/09_three_point_bending.html">9. Three-point bending</a></li><li><a href="../../../tutorials/10_quenching_bibeam.html">10. Quenching of bi-beam</a></li><li><a href="../../../tutorials/11_adaptivity.html">11. Adaptive mesh refinement</a></li><li><a href="../../../tutorials/12_surfing_boundary_problem.html">12. Surfing Boundary Problem</a></li></ul><ul class="dropdown-content" id="37b5cd3f-777d-4c90-a818-23a908c6070c"><li><a href="../../../theory/intro.html">Introduction</a></li><li><a href="../../../theory/kinematics.html">State variables and kinematics</a></li><li><a href="../../../theory/thermodynamics.html">Thermodynamics</a></li><li><a href="../../../theory/minimization.html">The minimization problem</a></li><li><a href="../../../theory/constitutive_models.html">Constitutive Models</a></li></ul><ul class="dropdown-content" id="c8035d71-9623-4167-ba42-1601b29fa6f0"><li><a href="../../index.html">Physics modules</a></li><li><a href="../../../syntax/index.html">Complete syntax</a></li><li><a href="../../../syntax/raccoon.html">RACCOON syntax</a></li><li><a href="../../../syntax/tensor_mechanics.html">Tensor mechanics syntax</a></li><li><a href="../../../syntax/phase_field.html">Phase field syntax</a></li><li><a href="../../../syntax/heat_conduction.html">Heat conduction syntax</a></li></ul></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="moose-content col s12 m12 l12"><section id="d861aa38-55c1-4ed0-ae8c-80f3eefe7ab5" data-section-level="1" data-section-text="Just in Time Compilation"><h1 id="just-in-time-compilation">Just in Time Compilation</h1><div class="card moose-float" style="width:50%;margin-left:20px;float:right;"><div class="card-content"><picture class="materialboxed moose-image"><img src="../../../media/phase_field/jitgraph_white.png"></img></picture><p class="moose-caption"><span class="moose-caption-text">Performance test results for the JIT compile FParser module</span></p></div></div><p>The version of the <em>Function Parser</em> library that ships with MOOSE contains a just in time (JIT) compilation feature that is not present in the <a href="http://warp.povusers.org/FunctionParser/">upstream version</a>.</p><p>Include the JIT module (which also adds <a href="AutomaticDifferentiation.html">automatic differentiation</a> support) with</p><pre class="moose-pre"><code class="language-cpp">
#include &quot;libmesh/fparser_ad.hh&quot;
</code></pre><p>The module provides the class</p><pre class="moose-pre"><code class="language-cpp">
FunctionParserADBase&lt;Real&gt;
</code></pre><p>which derives from</p><pre class="moose-pre"><code class="language-cpp">
FunctionParserBase&lt;Real&gt;
</code></pre><p>and provides the additional method</p><pre class="moose-pre"><code class="language-cpp">
bool JITCompile();
</code></pre><p>Calling this method on an FParser object will execute an attempt at</p><ul class="browser-default"><li><p>generating a small temporary C++ file with a function that performs the calculation of the parsed function </p></li><li><p>launching a compiler (the same compiler used to build libMesh) to compile the C++ file into a small dynamic library (<code>.so</code> file) </p></li><li><p>using <code>dlopen()</code> to immediately load the library file </p></li><li><p>using <code>dlsym()</code> to bind the compiled function to the FParser object</p></li></ul><p>If all steps above succeed all further evaluations (calls to <code>Eval()</code>) of the FParser object will be redirected to the compiled function, which will yield a speedup of about an order of magnitude, depending on the complexity of the function.</p><p>All temporary files will be cleaned up and if JIT compilation succeeded the compiled library will be cached in a directory named <code>.jitcache</code> in the local directory. The name of the function file is constructed using a sha1 hash of the function byte code.</p><p>Compile times are around 100ms per function object. Once cached the <code>JITCompile()</code> call will return after about 1ms. Changing numeric constants in the function will usually not trigger a recompilation. The compiled function respects the current FParser <code>Epsilon</code> setting.</p><p>Almost all FParser opcodes are supported, _except_ <code>PCall</code> and <code>FCall</code>, which are function calls to other FParser objects and calls to custom functions.</p><section id="d45064c8-67c6-48e7-996e-9e28d1c308ec" data-section-level="2" data-section-text="Required header files"><h2 id="required-header-files">Required header files</h2><p>JIT compilation for non-AD parsed functions only requires the <code>cmath</code> standard library header file. Compilation of AD functions with dual numbers  required the <code>ADReal.h</code> header and all headers recursively included by it. For binary-only application distribution these headers may not be readily available.</p><p>The make command <code>make ADRealMonolithic.h</code> can be used to build a redistributable header file sufficient for parsed function JIT compilation. This file can be distributed along with the application binary. The application will use this header to compile AD parsed material functions when the <code>MOOSE_ADFPARSER_JIT_INCLUDE</code> environment variable is set. E.g.:</p><pre class="moose-pre"><code class="language-text">
export MOOSE_ADFPARSER_JIT_INCLUDE=/usr/local/include/ADRealMonolithic.h
</code></pre></section></section></div></div></div></main></div></body><script type="text/javascript" src="../../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../../js/init.js"></script><script type="text/javascript" src="../../../js/navigation.js"></script><script type="text/javascript" src="../../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../../js/search_index.js"></script><script type="text/javascript" src="../../../js/sqa_moose.js"></script>